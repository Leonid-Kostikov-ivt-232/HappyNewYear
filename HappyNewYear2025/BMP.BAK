//           Самая простая программа для отображения картинок.
//          Отображает только <= 256 - цветовые НЕСЖАТЫЕ! BMP -
//          картинки,(некоторые некорректно). Рекомендуется для
//         изучения основных принципов и правил работы с графикой.
//     22.10.1999 Владимир Владимирович Гоголев 2:5090/96.5@FidoNet.org
#include <stdio.h>                      //Подключаем библиотеку ввода/вывода.
#include <conio.h>                      //----//---- текстовую библиотеку.
#include <graphics.h>                   //----//---- графическую библиотеку.
#include "bmp.h"

void bmp()
{                           //Начало программы.
 unsigned char b,r,g,pix;               //Временные переменные цвЕта.
 int driver=installuserdriver("svga256m",NULL), //256-color driver.

    x,y,                                //Текущие координаты.
    mode=2,                             //(0...4) Граф. режим (2 - 640x480).
    X=640,                              //Вертикальное разрешение.
    Y=480,                              //Горизонтальное разрешение.
    colors=256;                         //Количество цветов.
 FILE *fp;				//Указатель на файл.
 if ((fp=fopen("NY.bmp","r+b"))==NULL) return; //Открываем файл "1024.bmp".
 initgraph(&driver,&mode,"");		//Инициализируем графику.

 fseek(fp,54,SEEK_SET);				//Пропускаем заголовок.
 for (x=0;x<colors;x++)				//Читаем палитру:
 {                                              //B,G,R,ререзвный байт.
  fread(&b,1,1,fp);                             //Синяя составляющая.
  fread(&g,1,1,fp);                             //Зеленая ---//-----.
  fread(&r,1,1,fp);                             //Красная ---//-----.
  fseek(fp,1,SEEK_CUR);                         //Пропускаем резервный байт.
  setrgbpalette(x,r/4,g/4,b/4);                 //Устанавливаем текущий цвет.
 }                                              //Так происходит 256 раз.
 for (y=Y-1;y>=0;y--)                           //Отображаем картинку:
  for (x=0;x<X;x++)                             //В BMP картинка записана
  {                                             //вверх-ногами.Переворачиваем.
   fread(&pix,1,1,fp);                          //Читаем номер цвета.
   putpixel (x,y,pix);                          //Выводим прочитанный цвет
  }                                             //на пиксел с коорд. x,y;
 fclose(fp);                                    //Закрываем файл.
  getche();					//Ждем нажатия любой кнопки.
 //getch();					//Ждем нажатия любой кнопки.
 closegraph();                                  //Устанавливаем txt-mode.
}                                               //Конец программы.